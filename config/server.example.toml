# oxmon Server Configuration

# gRPC port for receiving metrics from agents
grpc_port = 9090

# HTTP port for REST API
http_port = 8080

# Directory for metric data storage (SQLite partition files)
data_dir = "data"

# How many days to retain metric data
retention_days = 7

# Require agent authentication (default: false)
require_agent_auth = false

# REST API Authentication (JWT)
[auth]
jwt_secret = "your-secret-key-here"
token_expire_secs = 86400       # Token validity period (default: 24 hours)
default_username = "admin"      # Default admin username
default_password = "changeme"   # Default admin password (change this!)

# Alert Rules
# Managed via REST API or CLI: oxmon-server init-rules <config> <seed.json>
# See config/rules.seed.example.json for examples

# Notification Channels
# Managed via REST API or CLI: oxmon-server init-channels <config> <seed.json>
# See config/channels.seed.example.json for examples
# Supported types: email, webhook, sms_aliyun, sms_tencent, sms_generic, dingtalk, weixin

# Runtime Settings (stored in database, managed via REST API)
# - notification_aggregation_window: Alert aggregation window in seconds (default: 60)
# - notification_log_retention: Notification log retention days (default: 30)
# - language: System language for notifications and alerts (default: "zh-CN", supported: "zh-CN", "en")
#   Change via: PUT /v1/system-configs/{id} with {"config_json": "{\"value\": \"en\"}"}

# Certificate Check Configuration
[cert_check]
enabled = true
default_interval_secs = 86400   # Default check interval (24 hours)
tick_secs = 60                  # Scheduler tick interval
connect_timeout_secs = 10       # TLS connection timeout per domain
max_concurrent = 10              # Max concurrent TLS connections

# Cloud Monitoring Configuration
[cloud_check]
enabled = true
default_account_collection_interval_secs = 3600  # Default per-account collection interval (1 hour, reduce provider rate limit risk)
tick_secs = 60                  # Scheduler tick interval (check for due accounts)
max_concurrent = 5              # Max concurrent cloud API calls

# AI Report Configuration
[ai_check]
enabled = true
tick_secs = 3600                # Scheduler tick interval (check for due AI accounts every hour)
history_days = 7                # Query historical data for the last N days
batch_size = 20                 # Batch size for processing agents (split when > 20)

# AI Accounts
# Managed via REST API or CLI: oxmon-server init-ai-accounts <config> <seed.json>
# See config/ai-accounts.seed.example.json for examples
# Supported providers: zhipu (GLM-4/GLM-5), kimi, minimax, claude, codex, custom
# Each AI account has configurable collection_interval_secs for report generation frequency

# Cloud Accounts
# Managed via REST API or CLI: oxmon-server init-cloud-accounts <config> <seed.json>
# See config/cloud-accounts.seed.example.json for examples
# Supported providers: tencent, alibaba
# Cloud instances appear as virtual agents with ID format: cloud:{provider}:{instance_id}
# Metrics: cloud.cpu.usage, cloud.memory.usage, cloud.disk.usage

# Application ID validation for public routes (health, login)
# When enabled, all unauthenticated API routes require the ox-app-id header
[app_id]
require_app_id = false           # Enable ox-app-id header validation (default: false)
allowed_app_ids = ["web-console", "mobile-app"]  # Allowed ox-app-id values (empty = accept any non-empty value)
