# oxmon Server Configuration

# gRPC port for receiving metrics from agents
grpc_port = 9090

# HTTP port for REST API
http_port = 8080

# Directory for metric data storage (SQLite partition files)
data_dir = "data"

# How many days to retain metric data
retention_days = 7

# Alert Rules
# Supported types: "threshold", "rate_of_change", "trend_prediction"

[[alert.rules]]
name = "high-cpu"
type = "threshold"
metric = "cpu.usage"
agent_pattern = "*"
operator = "greater_than"
value = 90.0
duration_secs = 300
severity = "critical"
silence_secs = 600

[[alert.rules]]
name = "memory-spike"
type = "rate_of_change"
metric = "memory.used_percent"
agent_pattern = "*"
rate_threshold = 20.0
window_secs = 300
severity = "warning"
silence_secs = 600

[[alert.rules]]
name = "disk-full-prediction"
type = "trend_prediction"
metric = "disk.used_percent"
agent_pattern = "*"
predict_threshold = 95.0
horizon_secs = 86400
min_data_points = 10
severity = "info"
silence_secs = 3600

# Notification Channels

[[notification.channels]]
type = "email"
min_severity = "warning"
smtp_host = "smtp.example.com"
smtp_port = 587
smtp_username = "alerts@example.com"
smtp_password = "your-password"
from = "alerts@example.com"
recipients = ["admin@example.com"]

[[notification.channels]]
type = "webhook"
min_severity = "info"
url = "https://hooks.slack.com/services/xxx/yyy/zzz"
# Optional: custom body template (uses {{agent_id}}, {{metric}}, {{value}}, {{severity}}, {{message}})
# body_template = '{"text": "[{{severity}}] {{agent_id}}: {{message}}"}'

# Silence Windows (suppress notifications during maintenance)

# [[notification.silence_windows]]
# start_time = "02:00"
# end_time = "04:00"
# recurrence = "daily"

# Aggregation window for batching similar alerts (seconds)
aggregation_window_secs = 60
